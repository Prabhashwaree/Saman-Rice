!function(e,t){var n,i,r,o=document.getElementById("subscriptionButton");function a(){return navigator.serviceWorker.ready.then(async function(e){const t=await fetch("/push-manager/pubkey/?uuid="+n+"&cid="+i,{method:"get",headers:{"X-Requested-With":"XMLHttpRequest"}}),r=function(e){for(var t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(n),r=new Uint8Array(i.length),o=0;o<i.length;++o)r[o]=i.charCodeAt(o);return r}((await t.json()).publicKey);return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r}).catch(function(e){s()})}).then(function(e){if(!e)return;const t=(r=e.options.applicationServerKey,btoa(String.fromCharCode.apply(null,new Uint8Array(r))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""));var r;return fetch("/push-manager/register/?uuid="+n+"&cid="+i,{method:"post",headers:{"Content-type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({subscription:e,publicKey:t})})}).then(h).catch(function(e){})}function u(){return navigator.serviceWorker.ready.then(function(e){return e.pushManager.getSubscription()}).then(function(e){return e.unsubscribe().then(function(){return fetch("/push-manager/unregister/?uuid="+n+"&cid="+i,{method:"post",headers:{"Content-type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({subscription:e})})})}).then(d)}function c(){r.prop("disabled",!1).parent(".hidden").removeClass("hidden")}function s(){r.prop("disabled",!0).parent(".hidden").addClass("hidden")}function d(){arguments.length?arguments[0]?(arguments[0].text(),c()):s():c(),o.onclick=a,o.classList.add("active")}function h(){arguments.length?arguments[0]?(arguments[0].text(),c()):s():c(),o.onclick=u,o.classList.remove("active")}o&&(r=e(o),n=r.data("uuid"),i=r.data("cid")),"serviceWorker"in navigator&&/\.com$/.test(window.location.hostname)&&navigator.serviceWorker.register("/sw.js",{updateViaCache:"none"}).then(function(e){n!==t&&navigator.serviceWorker.ready.then(function(e){return e.pushManager.getSubscription()}).then(function(e){if(e)return fetch("/push-manager/synchronize/?uuid="+n+"&cid="+i,{method:"post",headers:{"Content-type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({subscription:e})})}).then(function(e){if(e)return e.json()}).then(function(e){e&&e.status&&"ERR"===e.status&&101===e.code&&u().then(function(){a()})}).then(function(){o&&navigator.serviceWorker.ready.then(function(e){return e.pushManager.getSubscription()}).then(function(e){"denied"!==Notification.permission&&(e?h():d())})})},function(e){})}(jQuery);